package aeca.aladdin.service.impl;

import aeca.aladdin.domain.entity.AuthSubject;
import aeca.aladdin.domain.entity.Certificate;
import aeca.aladdin.domain.entity.Group;
import aeca.aladdin.domain.entity.Template;
import aeca.aladdin.service.CertificateService;
import org.springframework.stereotype.Service;

import java.util.Optional;

@Service
public class CertificateServiceImpl implements CertificateService {

    @Override
    public Certificate getCertificate(String certSerialNumber) {
        Optional<Certificate> result = TestData.certificates.stream().filter(certificate -> certificate.getSerialNumber().equalsIgnoreCase(certSerialNumber)).findAny();
        return result.orElse(null);
    }

    @Override
    public boolean certificateRevoke(String certSerialNumber, int code) {
        Certificate certificate = getCertificate(certSerialNumber);
        if (certificate.getStatus() != 1) {
            return false;
        }
        //todo происходит отзыв сертификата
        certificate.setStatus(6);
        certificate.setRevocationReason(code);
        return true;
    }

    @Override
    public boolean certificateReactivate(String certSerialNumber) {
        Certificate certificate = getCertificate(certSerialNumber);
        if (certificate == null || certificate.getRevocationReason() != 1) {
            return false;
        }
        //todo происходит восстановление сертификата
        certificate.setStatus(1);
        certificate.setRevocationReason(-1);
        return true;
    }

    @Override
    public Certificate createCertToCsr(String certFormat, int templateId, int authSubjectId, String file) {
        Optional<AuthSubject> subject = TestData.subjects.stream().filter(a -> a.getId() == authSubjectId).findFirst();
        if (!subject.isPresent()) return null;
        Optional<Template> template = TestData.templates.stream().filter(t -> t.getId() == templateId).findFirst();
        if (!template.isPresent()) return null;
        //todo создание сертификата
        Certificate certificate = new Certificate(10, "certificate10", "iAmSerialNumber10", "iAmFingerPrint10", template.get(),
                subject.get(), 1, -1, 1);
        certificate.setCertBase64("U3ViamVjdDogQ049dGVzdDEsT1U9RGVwYXJ0bWVudCxPPU9yZ2FuaXphdGlvbixMPUNpdHksREM9Q29tcG9uZW50LEM9UlUKSXNzdWVyOiBDTj10ZXN0Um9vdDEsT1U9RGVwYXJ0bWVudCxPPU9yZ2FuaXphdGlvbixMPUNpdHksREM9Q29tcG9uZW50LEM9UlUKLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQ5ekNDQTUyZ0F3SUJBZ0lVQTlZSExFSnlBRDQzL0Q1Y2t2RUp2bkFDVmZvd0NnWUlLb1pJemowRUF3SXcKZHpFU01CQUdBMVVFQXd3SmRHVnpkRkp2YjNReE1STXdFUVlEVlFRTERBcEVaWEJoY25SdFpXNTBNUlV3RXdZRApWUVFLREF4UGNtZGhibWw2WVhScGIyNHhEVEFMQmdOVkJBY01CRU5wZEhreEdUQVhCZ29Ka2lhSmsvSXNaQUVaCkZnbERiMjF3YjI1bGJuUXhDekFKQmdOVkJBWVRBbEpWTUI0WERUSXlNREV4TWpBNE1UQXpPVm9YRFRNMk1USXcKT1RBd01EQXdNRm93Y3pFT01Bd0dBMVVFQXd3RmRHVnpkREV4RXpBUkJnTlZCQXNNQ2tSbGNHRnlkRzFsYm5ReApGVEFUQmdOVkJBb01ERTl5WjJGdWFYcGhkR2x2YmpFTk1Bc0dBMVVFQnd3RVEybDBlVEVaTUJjR0NnbVNKb21UCjhpeGtBUmtXQ1VOdmJYQnZibVZ1ZERFTE1Ba0dBMVVFQmhNQ1VsVXdXVEFUQmdjcWhrak9QUUlCQmdncWhrak8KUFFNQkJ3TkNBQVJ2SFpVRzV3UVdMcktKM0tsQjM2S25iRy84dGdoTXBaREF1c3RHM2VLdHBLQ1JZZTdBYUpMTQpDOS9QQis3QUxGREQ2Wnk5WU1GTkRYSU1YVE5HQ1RWMW80SUNDVENDQWdVd0R3WURWUjBUQVFIL0JBVXdBd0VCCi96QWZCZ05WSFNNRUdEQVdnQlQ3WDJlWGZhVHNuTWVsVzRMMmU3dXNtbDlSZ1RCOEJnZ3JCZ0VGQlFjQkFRUncKTUc0d2JBWUlLd1lCQlFVSE1BS0dZR2gwZEhBNkx5OHhPVEl1TVRZNExqRXhNUzR4T1RJdloyVjBRMlZ5ZEM1dwphSEEvUTJGT1lXMWxQWFJsYzNSU2IyOTBNU1pUWlhKMlpYSkVUbE5PWVcxbFBXNTFiR3dtUTJWeWRHbG1hV05oCmRHVk9ZVzFsUFhSbGMzUlNiMjkwTVRBMUJnTlZIUkVFTGpBc2dSTmxlR0Z0Y0d4bFFHVjRZVzF3YkdVdVkyOXQKZ2c5M2QzY3VaWGhoYlhCc1pTNWpiMjJIQkFvS0NtNHdnZXdHQTFVZEh3U0I1RENCNFRDQjNxQmZvRjJHVzJoMApkSEE2THk4eE9USXVNVFk0TGpFeE1TNHhPVEl2WjJWMFExSk1MbkJvY0Q5RFlVNWhiV1U5ZEdWemRGSnZiM1F4CkprTlNURTVoYldWVGRXWm1hWGc5Ym5Wc2JDWkVaV3gwWVVOU1RFRnNiRzkzWldROVptRnNjMldpZTZSNU1IY3gKRWpBUUJnTlZCQU1NQ1hSbGMzUlNiMjkwTVRFVE1CRUdBMVVFQ3d3S1JHVndZWEowYldWdWRERVZNQk1HQTFVRQpDZ3dNVDNKbllXNXBlbUYwYVc5dU1RMHdDd1lEVlFRSERBUkRhWFI1TVJrd0Z3WUtDWkltaVpQeUxHUUJHUllKClEyOXRjRzl1Wlc1ME1Rc3dDUVlEVlFRR0V3SlNWVEFkQmdOVkhRNEVGZ1FVZ3BJNEhyczg1bTBUb2ZSVVhpZG0KcG5pOXJzY3dEZ1lEVlIwUEFRSC9CQVFEQWdHR01Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lEM2t3U2ZRM0FyUwpjbTQ0d3JDMS8ycHRMZ3UveDNrYTJHd256eGN5aTFubUFpRUFuU0puRVUxMnVKRFVPd2pvMXY1c3ZKMkZqTDBpCjRmUGJTcFFIdTMrWWFodz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQpTdWJqZWN0OiBDTj10ZXN0Um9vdDEsT1U9RGVwYXJ0bWVudCxPPU9yZ2FuaXphdGlvbixMPUNpdHksREM9Q29tcG9uZW50LEM9UlUKSXNzdWVyOiBDTj10ZXN0Um9vdDEsT1U9RGVwYXJ0bWVudCxPPU9yZ2FuaXphdGlvbixMPUNpdHksREM9Q29tcG9uZW50LEM9UlUKLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWRENDQWZtZ0F3SUJBZ0lVQ3BHVG0xOXZ2V21sMWpOelQvd3p2Q1RobnBVd0NnWUlLb1pJemowRUF3SXcKZHpFU01CQUdBMVVFQXd3SmRHVnpkRkp2YjNReE1STXdFUVlEVlFRTERBcEVaWEJoY25SdFpXNTBNUlV3RXdZRApWUVFLREF4UGNtZGhibWw2WVhScGIyNHhEVEFMQmdOVkJBY01CRU5wZEhreEdUQVhCZ29Ka2lhSmsvSXNaQUVaCkZnbERiMjF3YjI1bGJuUXhDekFKQmdOVkJBWVRBbEpWTUI0WERUSXhNVEl3T1RBNE5ESXdORm9YRFRNMk1USXcKT1RBd01EQXdNRm93ZHpFU01CQUdBMVVFQXd3SmRHVnpkRkp2YjNReE1STXdFUVlEVlFRTERBcEVaWEJoY25SdApaVzUwTVJVd0V3WURWUVFLREF4UGNtZGhibWw2WVhScGIyNHhEVEFMQmdOVkJBY01CRU5wZEhreEdUQVhCZ29KCmtpYUprL0lzWkFFWkZnbERiMjF3YjI1bGJuUXhDekFKQmdOVkJBWVRBbEpWTUZrd0V3WUhLb1pJemowQ0FRWUkKS29aSXpqMERBUWNEUWdBRUx3UEh2ZVRmc3ZSRk41V1BGbzM5NDZpOTE5SUlMeHQycXlOUlJBMzNHODZLaUo4QQpwWVd3eGRybGg3Z2l1Y2hvbFc5bUhlb3V3OWhWVDRYZHhGdldycU5qTUdFd0R3WURWUjBUQVFIL0JBVXdBd0VCCi96QWZCZ05WSFNNRUdEQVdnQlQ3WDJlWGZhVHNuTWVsVzRMMmU3dXNtbDlSZ1RBZEJnTlZIUTRFRmdRVSsxOW4KbDMyazdKekhwVnVDOW51N3JKcGZVWUV3RGdZRFZSMFBBUUgvQkFRREFnR0dNQW9HQ0NxR1NNNDlCQU1DQTBrQQpNRVlDSVFET2VUekFFS0x0Q2hoejgvRk5kMEdZZmVCdUNmUjZFcDJIMkh2S24rSXQrQUloQUlqZlNnV2xhMFN4CnZuMER1bGluUCthQzkzb1h1WWkyNmQ4K0d2MXBPUEdzCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=");
        return certificate;
    }

    @Override
    public Certificate createSubjectAndCertToCsr(String certFormat, int templateId, int groupId, String file) {
        Optional<Group> group = TestData.groups.stream().filter(g -> g.getId() == groupId).findFirst();
        if (!group.isPresent()) return null;
        Optional<Template> template = TestData.templates.stream().filter(t -> t.getId() == templateId).findFirst();
        if (!template.isPresent()) return null;
        if (!group.get().getTemplates().contains(template.get())) return null;
        //todo создание сертификата
        Certificate certificate = new Certificate(10, "certificate10", "iAmSerialNumber10", "iAmFingerPrint10", template.get(),
                TestData.subjects.stream().findAny().get(), 1, -1, 0);
        certificate.setCertBase64("U3ViamVjdDogQ049dGVzdDEsT1U9RGVwYXJ0bWVudCxPPU9yZ2FuaXphdGlvbixMPUNpdHksREM9Q29tcG9uZW50LEM9UlUKSXNzdWVyOiBDTj10ZXN0Um9vdDEsT1U9RGVwYXJ0bWVudCxPPU9yZ2FuaXphdGlvbixMPUNpdHksREM9Q29tcG9uZW50LEM9UlUKLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQ5ekNDQTUyZ0F3SUJBZ0lVQTlZSExFSnlBRDQzL0Q1Y2t2RUp2bkFDVmZvd0NnWUlLb1pJemowRUF3SXcKZHpFU01CQUdBMVVFQXd3SmRHVnpkRkp2YjNReE1STXdFUVlEVlFRTERBcEVaWEJoY25SdFpXNTBNUlV3RXdZRApWUVFLREF4UGNtZGhibWw2WVhScGIyNHhEVEFMQmdOVkJBY01CRU5wZEhreEdUQVhCZ29Ka2lhSmsvSXNaQUVaCkZnbERiMjF3YjI1bGJuUXhDekFKQmdOVkJBWVRBbEpWTUI0WERUSXlNREV4TWpBNE1UQXpPVm9YRFRNMk1USXcKT1RBd01EQXdNRm93Y3pFT01Bd0dBMVVFQXd3RmRHVnpkREV4RXpBUkJnTlZCQXNNQ2tSbGNHRnlkRzFsYm5ReApGVEFUQmdOVkJBb01ERTl5WjJGdWFYcGhkR2x2YmpFTk1Bc0dBMVVFQnd3RVEybDBlVEVaTUJjR0NnbVNKb21UCjhpeGtBUmtXQ1VOdmJYQnZibVZ1ZERFTE1Ba0dBMVVFQmhNQ1VsVXdXVEFUQmdjcWhrak9QUUlCQmdncWhrak8KUFFNQkJ3TkNBQVJ2SFpVRzV3UVdMcktKM0tsQjM2S25iRy84dGdoTXBaREF1c3RHM2VLdHBLQ1JZZTdBYUpMTQpDOS9QQis3QUxGREQ2Wnk5WU1GTkRYSU1YVE5HQ1RWMW80SUNDVENDQWdVd0R3WURWUjBUQVFIL0JBVXdBd0VCCi96QWZCZ05WSFNNRUdEQVdnQlQ3WDJlWGZhVHNuTWVsVzRMMmU3dXNtbDlSZ1RCOEJnZ3JCZ0VGQlFjQkFRUncKTUc0d2JBWUlLd1lCQlFVSE1BS0dZR2gwZEhBNkx5OHhPVEl1TVRZNExqRXhNUzR4T1RJdloyVjBRMlZ5ZEM1dwphSEEvUTJGT1lXMWxQWFJsYzNSU2IyOTBNU1pUWlhKMlpYSkVUbE5PWVcxbFBXNTFiR3dtUTJWeWRHbG1hV05oCmRHVk9ZVzFsUFhSbGMzUlNiMjkwTVRBMUJnTlZIUkVFTGpBc2dSTmxlR0Z0Y0d4bFFHVjRZVzF3YkdVdVkyOXQKZ2c5M2QzY3VaWGhoYlhCc1pTNWpiMjJIQkFvS0NtNHdnZXdHQTFVZEh3U0I1RENCNFRDQjNxQmZvRjJHVzJoMApkSEE2THk4eE9USXVNVFk0TGpFeE1TNHhPVEl2WjJWMFExSk1MbkJvY0Q5RFlVNWhiV1U5ZEdWemRGSnZiM1F4CkprTlNURTVoYldWVGRXWm1hWGc5Ym5Wc2JDWkVaV3gwWVVOU1RFRnNiRzkzWldROVptRnNjMldpZTZSNU1IY3gKRWpBUUJnTlZCQU1NQ1hSbGMzUlNiMjkwTVRFVE1CRUdBMVVFQ3d3S1JHVndZWEowYldWdWRERVZNQk1HQTFVRQpDZ3dNVDNKbllXNXBlbUYwYVc5dU1RMHdDd1lEVlFRSERBUkRhWFI1TVJrd0Z3WUtDWkltaVpQeUxHUUJHUllKClEyOXRjRzl1Wlc1ME1Rc3dDUVlEVlFRR0V3SlNWVEFkQmdOVkhRNEVGZ1FVZ3BJNEhyczg1bTBUb2ZSVVhpZG0KcG5pOXJzY3dEZ1lEVlIwUEFRSC9CQVFEQWdHR01Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lEM2t3U2ZRM0FyUwpjbTQ0d3JDMS8ycHRMZ3UveDNrYTJHd256eGN5aTFubUFpRUFuU0puRVUxMnVKRFVPd2pvMXY1c3ZKMkZqTDBpCjRmUGJTcFFIdTMrWWFodz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQpTdWJqZWN0OiBDTj10ZXN0Um9vdDEsT1U9RGVwYXJ0bWVudCxPPU9yZ2FuaXphdGlvbixMPUNpdHksREM9Q29tcG9uZW50LEM9UlUKSXNzdWVyOiBDTj10ZXN0Um9vdDEsT1U9RGVwYXJ0bWVudCxPPU9yZ2FuaXphdGlvbixMPUNpdHksREM9Q29tcG9uZW50LEM9UlUKLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWRENDQWZtZ0F3SUJBZ0lVQ3BHVG0xOXZ2V21sMWpOelQvd3p2Q1RobnBVd0NnWUlLb1pJemowRUF3SXcKZHpFU01CQUdBMVVFQXd3SmRHVnpkRkp2YjNReE1STXdFUVlEVlFRTERBcEVaWEJoY25SdFpXNTBNUlV3RXdZRApWUVFLREF4UGNtZGhibWw2WVhScGIyNHhEVEFMQmdOVkJBY01CRU5wZEhreEdUQVhCZ29Ka2lhSmsvSXNaQUVaCkZnbERiMjF3YjI1bGJuUXhDekFKQmdOVkJBWVRBbEpWTUI0WERUSXhNVEl3T1RBNE5ESXdORm9YRFRNMk1USXcKT1RBd01EQXdNRm93ZHpFU01CQUdBMVVFQXd3SmRHVnpkRkp2YjNReE1STXdFUVlEVlFRTERBcEVaWEJoY25SdApaVzUwTVJVd0V3WURWUVFLREF4UGNtZGhibWw2WVhScGIyNHhEVEFMQmdOVkJBY01CRU5wZEhreEdUQVhCZ29KCmtpYUprL0lzWkFFWkZnbERiMjF3YjI1bGJuUXhDekFKQmdOVkJBWVRBbEpWTUZrd0V3WUhLb1pJemowQ0FRWUkKS29aSXpqMERBUWNEUWdBRUx3UEh2ZVRmc3ZSRk41V1BGbzM5NDZpOTE5SUlMeHQycXlOUlJBMzNHODZLaUo4QQpwWVd3eGRybGg3Z2l1Y2hvbFc5bUhlb3V3OWhWVDRYZHhGdldycU5qTUdFd0R3WURWUjBUQVFIL0JBVXdBd0VCCi96QWZCZ05WSFNNRUdEQVdnQlQ3WDJlWGZhVHNuTWVsVzRMMmU3dXNtbDlSZ1RBZEJnTlZIUTRFRmdRVSsxOW4KbDMyazdKekhwVnVDOW51N3JKcGZVWUV3RGdZRFZSMFBBUUgvQkFRREFnR0dNQW9HQ0NxR1NNNDlCQU1DQTBrQQpNRVlDSVFET2VUekFFS0x0Q2hoejgvRk5kMEdZZmVCdUNmUjZFcDJIMkh2S24rSXQrQUloQUlqZlNnV2xhMFN4CnZuMER1bGluUCthQzkzb1h1WWkyNmQ4K0d2MXBPUEdzCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=");
        return certificate;
    }
}